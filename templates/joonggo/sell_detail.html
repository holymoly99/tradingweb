{% extends 'base.html' %}

{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'bootstrap.min.css' %}">

{% block content %}
  <div class="container my-3">
    {% if messages %}
    <div class="alert alert-danger my-3" role="alert">
      {% for message in messages %}
      <strong>{{ message.tags }}</strong>
      <ul><li>{{ message.message}}</li></ul>
      {% endfor %}
    </div>
    {% endif %}
    
    <h2 class="border-bottom py-2">{{ sell.subject }}</h2>
    <div class="row my-3">
      <div class="col-1.5">
        <div class="bg-light text-center p-3 border font-weight-bolder mb-1">
          {{ sell.voter.count }}</div>
        {% comment %} <a href="#" data-uri="{% url 'joonggo:vote_sell' sell.id %}" class="recommend btn btn-sm btn-secondary btn-block my-1">좋아요</a> {% endcomment %}
        {% if user in sell.voter.all %}
        <a href="#" data-uri="{% url 'joonggo:vote_sell' sell.id %}" class="recommend btn btn-sm btn-secondary btn-block my-1"><i class="fa-solid fa-heart"></i> 좋아요</a>
        {% else %}
        <a href="#" data-uri="{% url 'joonggo:vote_sell' sell.id %}" class="recommend btn btn-sm btn-secondary btn-block my-1"><i class="fa-regular fa-heart"></i> 좋아요</a>
        {% endif %}
        </div>
      <div class="col-11">
        {% comment %} 가격 : <span class="price" style="white-space: pre-line;">{{ sell.price }}</span> {% endcomment %}
        <div class="card">
          {% autoescape off %}
          <div class="card-text" style="white-space: pre-line;">{{ sell.content }}</div>
          {% endautoescape %}
          
          <div class="d-flex justify-content-end">
            <div class="badge badge-light p-2 text-left">
              <div class="mb-2">{{ sell.author.username }}</div>
              <div>{{ sell.create_date|date:"Y-m-d H:i" }}</div>
            </div>
          </div>
        </div>
        {% if request.user == sell.author %}
        <div class="my-3" align="right">
          <a href="{% url 'joonggo:sell_modify' sell.id %}" class="btn btn-sm btn-outline-secondary">수정</a>
          <a href="#" class="delete btn btn-sm btn-outline-secondary" data-uri="{% url 'joonggo:sell_delete' sell.id %}">삭제</a>
        </div>
        {% endif %}
        {% if sell.comment_set.count > 0 %}
        <div class="mt-3">
        {% for comment in sell.comment_set.all %}
          <div class="comment py-2">
            <span style="white-space: pre-line;">{{ comment.content }}</span>
            <span>
              - {{ comment.author }}, {{ comment.create_date }}
              {% if comment.modify_date %}
              (수정: {{ comment.modify_date }})
              {% endif %}
            </span>
            {% if request.user == comment.author %}
              <a href="{% url 'joonggo:comment_modify_sell' comment.id %}" class="small">수정</a>
              <a href="#" class="small delete" data-uri="{% url 'joonggo:comment_delete_sell' comment.id %}">삭제</a>
            {% endif %}
          </div>
        {% endfor %}
        </div>
        {% endif %}
        <div>
          <a href="{% url 'joonggo:comment_create_sell' sell.id %}"
          class="small"><small>댓글 달기</small></a>
        </div>
    </div>

{% endblock content %}

{% block script %}
<script>
  $(document).ready(function () {
    console.log('로딩 완료');
    let btns = $('.delete') // 변수 선언 키워드 let
    btns.on('click', function () { // .on('이벤트이름', 이벤트핸들러)
      console.log('click 발생');
      let answer = confirm('정말 삭제할까요?');
      if (answer) {
        location.href = $(this).data('uri'); // this: click이벤트를 발생한 인스턴스에 대한 참조
      }
    }); // 변수 선언 키워드 let
    $(".recommend").on('click', function () {
      if (confirm("정말로 추천하시겠습니까?")) {
        location.href = $(this).data('uri');
      } 
      
    })

    console.log('click 이벤트 핸들러 등록 완료')
  });
</script>

{% endblock script %}


